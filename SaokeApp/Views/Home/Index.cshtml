@model IndexViewModel
@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <p>Dữ liệu cung cấp bởi <a href="https://www.facebook.com/thongtinchinhphu/posts/pfbid03YkRTKZ5WjeHwBavPQbP7EShonj9tTExgY26gNhvQdiEsbjdsLWnzWEoQE1bU9SBl"> MTTQ</a> Learn about.</p>
    <p>Lưu ý: dữ liệu chỉ trong phạm vi từ 1/9/2024 đến 10/9/2024. Chúng tôi sẽ cập nhật khi có dữ liệu mới từ MTTQ.</p>
</div>

<div class="text-center">

    <div class="row">
        <div class="col">
            <input id="searchText" class="form-control mr-sm-2" type="search" placeholder="Tìm kiếm theo mã giao dịch, số tiền hoặc chi tiết giao dịch" aria-label="Search" value="@Model.Search">
        </div>
    </div>
    <div class="row mt-2">
        <div class="col">
            <input id="min" class="form-control mr-sm-2" type="number" placeholder="Min" aria-label="Min" value="@(Model.Min.HasValue? Model.Min.Value.ToString(): "")">
        </div>
        <div class="col ">
            <input id="max" class="form-control mr-sm-2" type="number" placeholder="Max" aria-label="Max" value="@(Model.Max.HasValue? Model.Max.Value.ToString(): "")">
        </div>
    </div>
    <div class="row mt-2">
        <div class="col-md-1">
            <button class="page-link" id="btn-search">
                Search
            </button>

        </div>
    </div>

    @if (!string.IsNullOrEmpty(Model.Search))
    {
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">Date</th>
                    <th scope="col">TransactionId</th>
                    <th scope="col">Amount</th>
                    <th scope="col">Message</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.DonateTracks)
                {
                    <tr>
                        <td>@item.CreatedAt.ToString("dd/MM/yyyy")</td>
                        <td>@item.TransactionId</td>
                        <td>@Helpers.RenderMoney(item.Amount)</td>
                        <td>@item.Message</td>
                    </tr>
                }
            </tbody>
        </table>
        <div class="d-flex flex-row-reverse">
            <nav aria-label="pagination">
                <ul class="pagination">
                    <li class="page-item @(Model.HasPreviousPage?"":"disabled")">
                        <button class="page-link" id="first">
                            <span aria-hidden="true">&laquo;</span>
                            <span class="sr-only">First</span>
                        </button>
                    </li>
                    @if (Model.PageNumber > 2)
                    {
                        <li class="page-item">
                            <button class="page-link">
                                ...
                            </button>
                        </li>
                    }
                    @if (Model.PageNumber == (Model.TotalPages) && Model.PageNumber - 2 >= 1)
                    {
                        <li class="page-item ">
                            <button class="page-link" id="backthird">
                                @(Model.PageNumber - 2)
                            </button>
                        </li>
                    }
                    @if (Model.PageNumber - 1 > 0)
                    {
                        <li class="page-item">
                            <button class="page-link" id="previous">
                                @(Model.PageNumber - 1)
                            </button>
                        </li>
                    }
                    <li class="page-item">
                        <button class="page-link" id="current">
                            @(Model.PageNumber)
                        </button>
                    </li>
                    @if (Model.PageNumber <= Model.TotalPages - 1)
                    {
                        <li class="page-item ">
                            <button class="page-link" id="next">
                                @(Model.PageNumber + 1)
                            </button>
                        </li>
                    }
                    @if (Model.PageNumber == 1 && Model.TotalPages >= 3)
                    {
                        <li class="page-item ">
                            <button class="page-link" id="third">
                                3
                            </button>
                        </li>
                    }
                    @if (Model.PageNumber <= Model.TotalPages - 2)
                    {
                        <li class="page-item">
                            <button class="page-link">
                                ...
                            </button>
                        </li>
                    }
                    <li class="page-item @(Model.HasNextPage?"":"disabled")">
                        <button class="page-link" id="last">
                            <span aria-hidden="true">&raquo;</span>
                            <span class="sr-only">Last</span>
                        </button>
                    </li>
                </ul>
            </nav>
        </div>
    }
    @section scripts {
        <script type="text/javascript">

            function openPage( search, page )
            {
                let min = $( '#min' ).val();
                let max = $( '#max' ).val();
                window.location.href = `?search=${search}&page=${page}&min=${min}&max=${max}&itemsPerPage=20`;
            }
            $( '#btn-search' ).on( "click", function ( e )
            {
                e.preventDefault();

                let text = $( '#searchText' ).val();
                openPage( text, 1 );
                return false;    //<---- Add this line

            } );

            $( '#previous' ).on( "click", function ( e )
            {
                e.preventDefault();
                let t = "@Model.Search";
                openPage( t, @(Model.PageNumber - 1) );
            } );

            $( '#next' ).on( "click", function ( e )
            {
                e.preventDefault();
                let t = "@Model.Search";
                openPage( t, @(Model.PageNumber + 1) );
            } );

            $( '#first' ).on( "click", function ( e )
            {
                e.preventDefault();
                let t = "@Model.Search";
                openPage( t, 1 );
            } );

            $( '#last' ).on( "click", function ( e )
            {
                e.preventDefault();
                let t = "@Model.Search";
                openPage( t, @(Model.TotalPages) );
            } );

            $( '#third' ).on( "click", function ( e )
            {
                e.preventDefault();
                let t = "@Model.Search";
                openPage( t, 3 );
            } );

            $( '#backthird' ).on( "click", function ( e )
            {
                e.preventDefault();
                let t = "@Model.Search";
                openPage( t, @(Model.TotalPages - 2) );
            } );
        </script>
    }
